
            +++ ish file converter（CP/M版 Ver. 1.10）の使い方 +++

                Copyright(C) 1986, 1987  by M. Ishizuka (pcs20210)
                All rights reserved.

０．はじめに
　ish file converterは、ﾊﾞｲﾅﾘｺｰﾄﾞ転送をｻﾎﾟｰﾄしていないbbsｾﾝﾀでﾊﾞｲﾅﾘｺｰﾄﾞをupload
/downloadするための、ﾊﾞｲﾅﾘ<->text形式のｺﾝﾊﾞｰﾀです。checksumによる誤り訂正とcrc
による強力な誤り検出を行い、１ﾌﾞﾛｯｸ(62〜72行)当り、任意の２行までのｴﾗｰを完全に
訂正します。
　誤り検出はほぼ完全と考えて問題ないため、正常に復元できたはずなのに動作しない
場合、再度downloadしてみないと、download時のｴﾗｰなのかﾌﾟﾛｸﾞﾗﾑのBUGなのか判断で
きないといった不都合はありません。ish file converterの特徴は､この誤り訂正・検
出と、downloadﾌｧｲﾙをきちんと切り出す必要がないことです。

[注意]
　このﾌﾟﾛｸﾞﾗﾑはZ80の機能を使用しているために、8080や8085では動作しません。
必ず、Z80(または同等なCPU)をご使用下さい。


１．簡単な使い方（downloadしたfileを復元する方法）

　　A>ish logfile /q　　　（注意：logfileには、downloadしたfile名を書きます。）

　　とすれば、logfileに含まれているfileを見つける毎に、復元するか否かを聞いて
　　きますので、y/nで答えて下さい。

  　また、使い方が分からなくなった場合には、単に

　　A>ish

　　とすれば、簡単な説明が表示されます。


２．downloadする時の操作

［書式］

　A>ish 入力ﾌｧｲﾙ名 [{/r|/a|/q}] [/m [d:]] [/c [d:]] [/9 [d:]]
                   [/? [d:]] [/* [d:]] [/lf]

［ｽｲｯﾁの説明］

  /r : restore new file(s)
       新しいﾌｧｲﾙのみ復元します。（既に、同名のﾌｧｲﾙがあるとｽｷｯﾌﾟします。）
  /a : restore all file(s)
       同名のﾌｧｲﾙがある場合には、ish$temp.000等の名前に変更して復元します。
  /q : restore with question
       復元するか否かを聞いてきますので、y､n､a､rまたはqで答えて下さい。
　　　 y: yes
　　　　　そのﾌｧｲﾙを復元します。次のﾌｧｲﾙを見つけると、また復元するか否かを聞い
　　　　　てきます。
　　　 n: no
　　　　　そのﾌｧｲﾙは復元せずにｽｷｯﾌﾟします。次のﾌｧｲﾙを見つけると、また復元するか
　　　　　否かを聞いてきます。
　　　 a: all
　　　　　そのﾌｧｲﾙ以降(そのﾌｧｲﾙを含む)を全て復元します。
       r: restore new
          そのﾌｧｲﾙ以降(そのﾌｧｲﾙを含む)の新しいﾌｧｲﾙのみ復元します。
　　　 q: quit
　　　　　ﾌｧｲﾙの復元を強制終了し、CP/Mに戻ります。
　/m : MS-DOS
　　　 MS-DOS用のﾌｧｲﾙを復元します。ﾄﾞﾗｲﾌﾞ(A:等)を指定すると、そこへ復元します。
　　　 ﾄﾞﾗｲﾌﾞの指定を省略するとｶﾚﾝﾄﾄﾞﾗｲﾌﾞに復元します。
　/c : CP/M and/or MSX-DOS
       CP/M用、MSX-DOS用のﾌｧｲﾙを復元します。ﾄﾞﾗｲﾌﾞの指定が可能です。
  /9 : OS-9
       OS-9用のﾌｧｲﾙを復元します。ﾄﾞﾗｲﾌﾞの指定が可能です。
　/? : other OSs
　　　 MS-DOS､CP/M､MSX-DOS､OS-9用以外のﾌｧｲﾙを復元します。ﾄﾞﾗｲﾌﾞの指定が可能で
       す。
  /* : all OSs
       OSに依存しないﾌｧｲﾙを復元します。ﾄﾞﾗｲﾌﾞの指定が可能です。
  /lf: ignore CR and LF
       ﾌｧｲﾙの復元時にCR､LFを無視します。これは、何等かの事情でCR､LFが誤って大
       量に混入した場合に指定します。ﾌｧｲﾙの復元に要する時間が大幅に増える上に、
       文字化けの訂正能力が若干劣るので、通常は指定しません。

　スイッチを省略すると、/r/c/*が指定されたものと見なします。

［説明］

　入力ﾌｧｲﾙに含まれている複数のish形式のﾌｧｲﾙを復元します。入力ﾌｧｲﾙは、ish形式の
ﾌｧｲﾙをきちんと切り出す必要はありません。例えば、loginした時からlogoutまでのlog
-file全体を入力すれば､自動的にish形式のﾌｧｲﾙを抽出して復元します。
　ｽｲｯﾁの指定を省略または/rを指定した時には、既に同名のﾌｧｲﾙがある場合には、その
ﾌｧｲﾙは復元されずにskipされます。/aを指定すると、同名のﾌｧｲﾙがある場合には、ish$
temp.000などのﾌｧｲﾙ名に変更して、対象OSの全てのﾌｧｲﾙを復元します。/qを指定した場
合には、復元するか否かをy/n/a/qで答えることができます。
　但し、disk fullになると、そこで処理を打ち切ります。
　復元対象OSは、通常は、CP/M用のものとOSに依存しないものだけですが、/m､/c､/9､
/?､/*を指定することにより変更できます。（/qを指定した場合に限り、何も指定しな
いと全てのOSを対象とします。）例えば、CP/M用とOS-9用を復元したい時には、/c/9と
指定します。また、それぞれのOS毎に、復元先のﾄﾞﾗｲﾌﾞを分けることができます。例え
ば、/m a:/c b:と指定すれば、MS-DOS用のfileはa:に、CP/M用のfileはb:に復元されま
す。ﾄﾞﾗｲﾌﾞを指定しないと、ｶﾚﾝﾄﾄﾞﾗｲﾌﾞに復元されます。
　/lfは、何等かの事情でCR､LFを無視したい時に指定します。但し現在のish formatは
CR､LFが行の区切りとして存在することを前提条件にして設計されているため、これを
指定すると、復元時間が余計にかかる上に、誤り訂正が正常に行えない場合があります
ので、必要な時以外は指定しないで下さい。（ただし、fileが正常に復元できた場合の
信頼性は、/lfを指定しても全く問題ありません。）

［使用例］

　A>ascii.log /a /m b: /c c: /9 d: /? e: /* f:

［実行例］

　ish file converter for CP/M (Z80 only)  Ver 1.10
  Copyright.......
  [ restore <all> (m,c,9,?,*)]
                   ^m,c,9,?,*はそれぞれどのOS用のﾌｧｲﾙを復元するかを示します。
　[10] ISH     .ARC(c) : ooooooooooo
    ^ish.arcは入力ﾌｧｲﾙの10行目からにあることを示します。
       file restored successfully.
  [1234] AAAAAAAA.AAA(*) : oo21oo2ox
　　　　　　　　　　　　　　 ^数字はそのﾌﾞﾛｯｸ中のｴﾗｰの行数を示します。
　　　　　　　　　　　　　　　（oはｴﾗｰなし、xは３行以上のｴﾗｰ）
       error ditect ... abort this file ( more than .................... )
       output file is deleted.
       error lines => [1889]->(%)   [1895]->(7)   [1902]->(A)
　　　　　             ^入力ﾌｧｲﾙの1889行目にerrorがあったことを示します。
　　　　　　           ( )内の値は、errorがあった行の先頭の１バイトを示します。
                       復元できなくなった原因の３行について表示します。
  [2010] ISH     .ARC(m) > ish_temp.000 : ooooooooooo
                      ^MS-DOS用　　　 ^ish.arcが既に復元されていたため、別の名
　　　　　　　　　　　　　　　　　　　 前で復元された。
       file restored successfully.

［特記事項］
  ish fileの形式がJIS8､shiftJIS､JIS7､oldのいずれであるかは、自動識別されますの
 で、復元時には意識する必要はありません。


３．uploadする時の操作

［書式］

　A>ish 入力ﾌｧｲﾙ名 {/s|/s8|/ss|/s7} [{/m|/c|/9|/?|/*}[d:]]
                   [{/n|/e}] [/t [行数]]

［スイッチの説明］

　/s : store a default format ish file
       CP/M版では、/s8と同じです。
  /s8: store a JIS8 format ish file
       JIS8 formatのishﾌｧｲﾙを作成します。（JIS8の通信のできるbbsｾﾝﾀの時、指定
　　　 します。ｶﾅが使用できるｾﾝﾀであってもJIS7で通信する場合には、JIS7 format
       よりもupload/downloadの効率が悪くなり、文字化けにも弱くなるため、/s7を
　　　 指定して下さい。）
  /ss: store a shift JIS format ish file
       shift JIS formatのishﾌｧｲﾙを作成します。（shift JISｺｰﾄﾞを使用しているbbs
　　　 ｾﾝﾀの時、指定します。漢字が使用できるbbsｾﾝﾀであっても、JIS漢字やNEC漢字
　　　 などを使用するｾﾝﾀの場合には、JIS8 formatよりもupload/downloadの効率が悪
       い上に、文字化けにも弱くなり、downloadした漢字ｺｰﾄﾞをshift JISに修正する
　　　 通信ｿﾌﾄ(CTERMなど)以外ではdownloadできないため、/s8または/s7を指定して
　　　 下さい。）
  /s7: store a JIS7 format ish file
       JIS7 formatのishﾌｧｲﾙを作成します。（JIS7で通信するbbsｾﾝﾀの時、指定しま
　　　 す。JIS8やshift JISｺｰﾄﾞを使用しているbbsｾﾝﾀの時には、JIS8やshift JISの
       方が効率がいいので、/s8や/ssを指定して下さい。）
　/m : MS-DOS
　　　 MS-DOS用の属性のishﾌｧｲﾙを作成します。ﾄﾞﾗｲﾌﾞの指定が可能です。
　/c : CP/M and/or MSX-DOS
　　　 CP/M用、MSX-DOS用の属性のishﾌｧｲﾙを作成します。ﾄﾞﾗｲﾌﾞの指定が可能です。
　/9 : OS-9
　　　 OS-9用の属性のishﾌｧｲﾙを作成します。ﾄﾞﾗｲﾌﾞの指定が可能です。
  /? : other OSs
　　　 MS-DOS､CP/M､OS-9以外用の属性のishﾌｧｲﾙを作成します。ﾄﾞﾗｲﾌﾞの指定が可能
　　　 です。
  /* : all OSs
　　　 OSに依存しない属性のishﾌｧｲﾙを作成します。ﾄﾞﾗｲﾌﾞの指定が可能です。
  /n : no escape sequence
       ｺﾒﾝﾄ行やﾀｲﾄﾙのｴｽｹｰﾌﾟｼｰｹﾝｽ（緑色、水色）を省略します。
  /e : escape sequence
       ｺﾒﾝﾄ行を緑色に、ﾀｲﾄﾙを水色にします。但し、bbsｾﾝﾀによっては、ｴｽｹｰﾌﾟｼｰｹﾝｽ
　　　 は使用できないことがあります。
　/t : title
　　　 指定された行数毎にﾀｲﾄﾙを表示します。行数を｢0｣にするか､行数を省略すると、
　　　 ﾀｲﾄﾙは表示されません。行数を｢1｣にするか､/tを省略すると、50行毎にﾀｲﾄﾙが
　　　 表示されます。行数を2-65535にすると、その行数毎にﾀｲﾄﾙが表示されます。ﾀｲ
　　　 ﾄﾙには、そのﾌｧｲﾙ名と、現在の行数と、最後の行数が表示されます。

　/m,/c,/9,/?,/*の指定を省略すると、/cが指定されたものと見なします。（upload
　する場合には、/m,/c,/9,/?,/*はいずれか１つしか指定できません。同時に複数指定
　すると、illegal switch(es) errorになります。）
　また、/n,/eの指定を省略すると、/nが指定されたものと見なします。/tを指定しな
　いと、50行毎にﾀｲﾄﾙが表示されます。

［説明］

　入力ﾌｧｲﾙ名.ishという名前でｶﾚﾝﾄﾃﾞｨﾚｸﾄﾘにishﾌｧｲﾙを作成します｡ascii-netのように
shift JISを使用しているbbsｾﾝﾀにuploadする場合には、/ssまたは/s8を指定します。
（/ssはshift JISの漢字ｺｰﾄﾞも使用するため、/s8より効率が高いのですが、第２水準
の漢字ｺｰﾄﾞも使用するため、第２水準の表示できないﾊﾟｿｺﾝで表示させると、豆腐(■)
が表示されます。なお、ish formatでは、JIS7､JIS8､shift JISの各formatは、それぞ
れの規格で定義されている表示可能な文字のみを使用しているため、空白や豆腐が表示
された場合には、文字化けや雑音の挿入があったことが分かります。但し、shift JIS
formatで第２水準の漢字ROMがない機種でも、表示が正常に行われないだけで、fileの
復元は正常に行えますし、雑音の挿入や文字の欠落の場合には１行の文字数が乱れるた
め、どの程度の文字化けがあるかの大略はわかるため、効率が問題となる長いprogram
の場合には、/ssを指定する方がいいでしょう。/ssを指定すれば、長いprogramならば
jcと同程度の効率になります。）
　JIS7を使用しているｾﾝﾀで使用する場合には、/s7を指定して下さい。
　/m,/c,/9,/?,/*は、そのprogramがどのOS用かを示す物ですので、正しいものを指定
して下さい。省略するとCP/M用のものと解釈します。また、ish fileをｶﾚﾝﾄﾄﾞﾗｲﾌﾞ以
外に作成したい場合には、ﾄﾞﾗｲﾌﾞを指定します。例えば、/m b:と指定すれば、MS-DOS
用の属性で、b:に作成されます。
　/n,/eはｺﾒﾝﾄ行（１行目）を緑色にするか否か及び、ﾀｲﾄﾙを水色にするか否かを指定
します。/eを指定すると、ｴｽｹｰﾌﾟｼｰｹﾝｽを使用して、ｶﾗｰ表示にします。ただし、ｴｽｹｰﾌﾟ
ｼｰｹﾝｽが認められていないbbsｾﾝﾀの場合には、/eを指定しても、正常にuploadできませ
んので、/nを指定します。（誤って/eを指定してもｴｽｹｰﾌﾟｼｰｹﾝｽが正常にuploadできな
いだけで、ﾃﾞｰﾀ本体には影響ないので、downloadは正常にできますが。）なお、/n,/e
を指定しないと/nが指定されたものと見なします。
　/tはﾀｲﾄﾙを何行毎に表示するかを指定します。ﾀｲﾄﾙを表示したくない場合には、/tま
たは、/t0と指定します。/t1を指定するか、/tを省略すると、ﾃﾞﾌｫﾙﾄの行数(50行)毎に
ﾀｲﾄﾙを表示します。/t2から/t65535を指定すると、その行数毎にﾀｲﾄﾙを表示します。ﾀｲ
ﾄﾙの内容は以下の通りです。
（ﾀｲﾄﾙの例）
--- test.arc (100/256) ---
　この例では、ﾌｧｲﾙ名がtest.arcで、全体の大きさが256行で現在100行目を処理してい
ることがわかります。/eを指定した場合には、｢ｰｰｰ｣の代わりに、水色の表示になりま
す。

［使用例］

　A>ish_doc.arc /ss /*

［実行例］

　ish file converter for CP/M (Z80 only)  Ver 1.10
  Copyright.......
  [ store <shift JIS format> (*)]
  ish_file is created.

［特記事項］
 (1)変換できるfileの大きさは、ﾃﾞｨｽｸの容量によってのみ制限されます。
 (2)shift JIS formatのものを旧ﾊﾞｰｼﾞｮﾝのish file converter(version 1.0x)で復元
    しようとすると、use upper versionというｴﾗｰが起きます。
 (3)JIS7 formatのものを旧ﾊﾞｰｼﾞｮﾝのish file converterで復元しようとしても、ish
    fileは検出されません。
 (4)JIS7 formatでは13bit encodingを、shift JIS formatの時には15bit encodingを
　　行っているため、誤り訂正や検出を厳密に行っているにも関わらず、ﾌｧｲﾙの肥大化
　　はｴﾗｰ訂正を行わない既存のｺﾝﾊﾞｰﾀ並に収まっています。


４．旧ﾊﾞｰｼﾞｮﾝ(CP/M用Ver 1.02)との違いについて
(1)shift-JIS format及びJIS7 formatの作成、復元が可能になりました。
(2)ﾌｧｲﾙの作成、復元時にﾄﾞﾗｲﾌﾞの指定が可能になりました。
(3)ﾌｧｲﾙを復元する際、復元するか否かを問い合わせるﾓｰﾄﾞ(/q)を追加しました。
(4)ish fileを作成する場合、ish fileの第１行目(ｺﾒﾝﾄ行)に、ish fileの行数を表示
　するようにしました。
(5)ish fileを作成する場合、指定された行数毎にﾀｲﾄﾙを表示するようにしました。
(6)ﾌｧｲﾙの復元の際に、CR､LFを無視して処理する指定(/lf)を追加しました。
(7)同名のﾌｧｲﾙが既に存在しているために、renameして復元する場合のﾌｧｲﾙ名は、旧
　ﾊﾞｰｼﾞｮﾝではish_temp.000等でしたが、ish$temp.000等に変更しました。これは、
　CP/Mの中には、ﾌｧｲﾙ名に｢_｣が使用できないものがあることが判明したからです。
(8)ｴﾗｰのために復元できない場合、ｴﾗｰが何行目であるか等の情報が表示されます。
(9)裏ﾚｼﾞｽﾀ(AF'､BC'､DE'､HL')及びｲﾝﾃﾞｯｸｽﾚｼﾞｽﾀ(IX､IY)を全て使用しています。なお、
　ish file converter(1.10)ではこれらのﾚｼﾞｽﾀをCP/M自体では使用していないことを
　前提にしていますので、BDOS CallでDE'､HL'を破壊するCP/Mでは動作しません。ま
　た、IX､IY､AF'､BC'もﾜｰｸで使用しているため、これらの値をｱﾌﾟﾘｹｰｼｮﾝで変更される
　と動作しないようなCP/Mでも動作しません。
　　これらのために動かないCP/Mがありましたら、(ｱ)BDOS Callの時にﾚｼﾞｽﾀをｾｰﾌﾞす
　るようにｿｰｽを修正する、(ｲ)BDOS Callを横取りしてﾚｼﾞｽﾀをｾｰﾌﾞする常駐ﾙｰﾁﾝを作成
　する、(ｳ)BDOSを修正する、のいずれかの方法で対処して下さい。


５．MS-DOS用のish file converterとの違いについて
　ish file converter for CP/M  Ver. 1.10はMS-DOSのish file converterとほぼ同等
の機能を持っていますが、OSの違いなどの理由で以下に示す点が異なります。
(1)ｽﾋﾟｰﾄﾞが遅い。
(2)ﾌｧｲﾙの作成､復元時にMS-DOS版ではdiskの残り容量をﾁｪｯｸしますが、CP/M版ではﾁｪｯｸ
　しません。これは、CP/MはそのｺﾝﾊﾟﾁなOS(MSX-DOSやRACET-DOS等)やCP/Mｴﾐｭﾚｰﾀのﾊﾞｰ
　ｼﾞｮﾝにより、diskの残り容量のﾁｪｯｸの方法が異なるために、diskの残り容量をﾁｪｯｸす
　ると汎用性がなくなるからです。
(3)ﾀｲﾑｽﾀﾝﾌﾟは保存しません。これもCP/M ﾊﾞｰｼﾞｮﾝ2.2までには、この機能がないためで
　す。
(4)ﾌｧｲﾙ名に漢字やｶﾅの使用ができない(CP/M自体の制限による)。このため、MS-DOSなど
　 で作成した漢字やｶﾅのﾌｧｲﾙ名のものを復元すると、漢字やｶﾅは'$'に変更されます．
(5)MS-DOS用のishの旧ﾊﾞｰｼﾞｮﾝ(Version 1.01以前)との互換性のための/o指定ができな
　 い。(但し、/o指定で作成されたﾌｧｲﾙでも、復元機能はｲﾝﾌﾟﾘﾒﾝﾄしてありますので、
   完全に復元可能ですので、安心して下さい。)
(6)/lを指定するとｴﾗｰになる。（MS-DOS版では昔のﾊﾞｰｼﾞｮﾝとの互換性のために、/lは
　ﾀﾞﾐｰｽｲｯﾁになっており、/lを指定してもｴﾗｰになりません。）


６．ｴﾗｰﾒｯｾｰｼﾞについて
　illegal switch(es)    : ｽｲｯﾁの指定が誤っている。
　　　　　　　　　　　　　（ｽｲｯﾁが未定義、ｽｲｯﾁの組合せが間違っているなど）
　file not found        : 入力ﾌｧｲﾙが見つからない。
　file open error       : 入力ﾌｧｲﾙがopenできない。
　file read error       : 入力ﾌｧｲﾙの読み込み中にｴﾗｰが発生した。
　file creation error   : 出力ﾌｧｲﾙが作成できなかった。(ﾗｲﾄﾌﾟﾛﾃｸﾄｼｰﾙが貼ってあ
                          った等)
　file write error      : 出力ﾌｧｲﾙの書き込みが正常に行えなかった。(ﾃﾞｨｽｸﾌﾙ等)
  directory full        : ﾃﾞｨﾚｸﾄﾘﾌﾙまたはﾌｧｲﾙ名が不適である。
  too short memories    : ishを実行するのに必要なﾒﾓﾘ(24KB)が確保できない。
　error detect          : 文字化けがひどすぎて、復元できなかった。
　crc error detect      : crcｴﾗｰが検出された。
　This format can not･･ : そのﾊﾞｰｼﾞｮﾝのish file converterでは扱えない形式のish
　　　　　　　　　　　　　ﾌｧｲﾙである。（shit JIS formatのものを旧ﾊﾞｰｼﾞｮﾝのish
　　　　　　　　　　　　　file converterで復元しようとした場合など。）
  file already exist    : ish fileを作成する時に、既にish fileが存在していた。


７．使用・配布について
　ish file converterはpdsとして誰でも無料で使用していただくために作成したもの
です。ｵﾘｼﾞﾅﾙのまま手を加えずに無料で配布していただけるものであれば、原則として
どのBBSへ転載していただいても構いません。また、個人的に使用する場合においては、
いかなる改造も自由に行っていただいて構いません。（この場合には、改造したﾌﾟﾛｸﾞﾗﾑ
の配布が必要な場合には、私へご照会下さい。）
　ただし、著作権が侵害される恐れのあるBBS(掲載するだけで、改作権､販売権､優先使
用権等を主張しているBBS)への転載はご遠慮下さい。また､bug-fixや改良等は当面ascii
net(pcs)でのみ行う予定ですので、他のBBSへ転載した場合には、転載した方が責任を持
ってbug-fixなどのﾌｫﾛｰを行っていただくか、あるいは、pcsでのみﾌｫﾛｰすることを明示
して、配布するようにして下さい。なお、書面による確認なしに営利目的に使用するこ
とは固くお断りいたします｡
　ご不明の点がございましたら、電子mailでお願いします。（mailは、私がｱｸｾｽしてい
るbbsならどこへいただいても結構です。ただ、bbsによっては、ｱｸｾｽ頻度が低いために
回答が遅れる場合もございますので、お急ぎの場合は、pcsへお願いします。）

                                86/10/13 written by M. Ishizuka (pcs20210)
                                86/10/19 update for MS-DOS Ver. 1.02a
                                86/12/14 update for MS-DOS Ver. 1.10
                                87/5/24  update for MS-DOS Ver. 1.11
                                87/6/14  update for MS-DOS Ver. 1.11b
                                87/7/4   update for MS-DOS Ver. 1.11e
                                87/8/3   update for MS-DOS Ver. 1.12
                                87/8/16  update for CP/M Ver. 1.10

